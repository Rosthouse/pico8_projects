pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

#include include/math.lua
#include include/particles.lua

plr_pos = 1
spd = 0.05

off = 15
r = .5
d60 = 60 / 360
d30 = 30 / 360

spr_tbl = {
  { b = 3, x = true, y = true },
  { b = 1, x = false, y = true },
  { b = 3, x = false, y = true },
  { b = 3, x = false, y = false },
  { b = 1, x = false, y = false },
  { b = 3, x = true, y = false }
}

lsr_tbl = {}

oh = 60 -- outer hex
ih = 10 -- inner hex
cx = 64 -- center x
cy = 54

function _update()
  sfx(0)
  if btnp(⬅️) then
    plr_pos = iwrap(plr_pos + 1, 1, 7)
  end

  if btnp(➡️) then
    plr_pos = iwrap(plr_pos - 1, 1, 7)
  end

  if btnp(❎) then
    sfx(2)
    add(lsr_tbl, { p = plr_pos, r = 1 })
  end

  for _, l in pairs(lsr_tbl) do
    l.r -= .05
    if l.r <= 0 then
      del(lsr_tbl, l)
    end
  end

  r += spd
  if r > 1 then r = 0 end
  part:update()

  if rnd() > 0.75 then
    local d = rnd()
    local px, py = poc(7.5, d)
    part:spw(cx + px, cy + py, d, 5, 20, 6, .5, 4)
  end
end

function _draw()
  cls()
  part:draw()

  -- draw hexagons
  dhex(ih, cx, cy)
  dhex(oh, cx, cy)

  -- d = lerp(ih, oh, r)
  -- dhex(d, 64, 64)

  for i = 1, 6, 1 do
    local x1, y1 = poc(1, i * d60)
    line(cx + x1 * oh, cy + y1 * oh, cx + x1 * ih, cy + y1 * ih, i)
  end

  -- draw lasers
  for _, l in pairs(lsr_tbl) do
    local lx1, ly1 = poc(lerp(0, oh, l.r), l.p / 6 - 1 / 12)
    circfill(cx + lx1, cy + ly1, lerp(0, 3, l.r), 10)
  end

  -- draw player
  dplr(plr_pos)

  -- draw ui
  rectfill(0, 110, 128, 128, 8)
end

function dhex(f, x, y)
  for i = 1, 6, 1 do
    w = iwrap(i + 1, 1, 7)
    x1, y1 = poc(1, i * 60 / 360)
    x2, y2 = poc(1, w * 60 / 360)
    line(x + x1 * f, y + y1 * f, x + x2 * f, y + y2 * f, i)
  end
end

function dplr(plr_pos)
  print(plr_pos)
  spt = spr_tbl[plr_pos]
  local x, y = poc(1, (plr_pos - 1) * d60 + d30)
  spr(spt.b, 56 + x * 50, 56 + y * 50, 2, 2, spt.x, spt.y)
end

__gfx__
00000000000000000000000000000aaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000aa00aa00000000aa888aaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000aaa0000aaa00000aa8aa8aaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000aaaa0000aaaa000aa8aa8aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000a8aaa0000aaa8a00a8aa8aaa00000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070008a8aa0000aa8a80aa888aaa00000aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a8a8aa0000aa8a8aaaeeaaa00000aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a8a8aa0000aa8a8aaeeaaa00000aa88a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000a8a8aa0000aa8a8aeeeaa00000aa8a8a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aa8aaa0000aaa8aaeeaaa0000aa8aa8a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaeeaa00aaeeaaaeaccc000aa8aa8aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaeeaaccaaeeaa00accccaaa8aa8aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaeeaccccaeeaa00aacccaaaa88aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aeeaccccaeea0000aaccaaaeeeaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000eeaaaaaaee000000aaaaaeeeaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000ee000000ee00000000aaaeea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000ee000000ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
93040801182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220
911000000e723097230e723097230e723097230e723097230e723007030e723007030e723007030e723007030e703007030e703007030e703007030e703007030070300703007030070300703007030070300703
01020801301512c1512915125151201511a1511615114151161011110110101161011610116101151011510115101141011410113101131011310113101131011210112101121011310113101141011410115101
01040801182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255
01040801182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255
00100000160502a0502a0502a05029050290502105022050230502505000000290502c0502f0503205034050330502d0502905024050210501c05019050160501505014050130501405015050000000000000000
__music__
00 01054344


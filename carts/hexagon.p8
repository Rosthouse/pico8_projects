pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

-- hexagon
-- by rosthouse
#include include/math.lua
#include include/particles.lua

-- player
plr_pos = 1
plr_r = 50
lsr_tbl = {}

-- rendering
lr = .5 -- wandering line radius
spd = 0.05 -- wandering line speed

d60 = 60 / 360
d30 = 30 / 360

oh = 50 -- outer hex radius
ih = 10 -- inner hex radius
cx = 64 -- center x
cy = 54 -- center y

spr_tbl = {
  -- Sprite flip table
  { b = 3, x = true, y = true },
  { b = 1, x = false, y = true },
  { b = 3, x = false, y = true },
  { b = 3, x = false, y = false },
  { b = 1, x = false, y = false },
  { b = 3, x = true, y = false }
}

-- asteroids
ast_spw = 0.9
ast_spd = 0.01
ast_tbl = {}

function _update()
  -- Run sound
  sfx(0)
  hxg_update()
  prl_update()
  lsr_update()
  ast_update()
  part_update()
end

function hxg_update()
  lr += spd
  if lr > 1 then lr = 0 end
end

function prl_update()
  if btnp(⬅️) then
    plr_pos = iwrap(plr_pos + 1, 1, 7)
  end

  if btnp(➡️) then
    plr_pos = iwrap(plr_pos - 1, 1, 7)
  end

  if btnp(❎) then
    sfx(2)
    add(lsr_tbl, { p = plr_pos, r = 1 })
  end
end

function lsr_update()
  for _, l in pairs(lsr_tbl) do
    l.r -= .05
    if l.r <= 0 then
      del(lsr_tbl, l)
    end
  end
end

function ast_update()
  if rnd() > ast_spw then
    add(ast_tbl, { d = flr(rnd(7)), r = 0, p = flr(rnd(3)) })
  end
  for _, a in pairs(ast_tbl) do
    a.r += ast_spd
  end
end

function part_update()
  part:update()

  if rnd() > 0.75 then
    local d = rnd()
    local px, py = poc(7.5, d)
    part:spw(cx + px, cy + py, d, 5, 20, 6, .5, 4)
  end
end

function _draw()
  cls()
  part:draw()

  hxg_draw()
  lsr_draw()
  ast_draw()
  plr_draw()
  ui_draw()
  -- draw ui
end

function hxg_draw()
  dhex(ih, cx, cy)
  dhex(oh, cx, cy)

  d = lerp(ih, oh, lr)
  dhex(d, cx, cy)

  for i = 1, 6, 1 do
    local x1, y1 = poc(1, i * d60)
    line(cx + x1 * oh, cy + y1 * oh, cx + x1 * ih, cy + y1 * ih, i)
  end
end

function lsr_draw()
  for _, l in pairs(lsr_tbl) do
    local lx1, ly1 = poc(lerp(0, oh, l.r), l.p / 6 - 1 / 12)
    circfill(cx + lx1, cy + ly1, lerp(0, 3, l.r), 10)
  end
end

function ast_draw()
  for _, a in pairs(ast_tbl) do
  end
end

function dhex(f, x, y)
  for i = 1, 6, 1 do
    w = iwrap(i + 1, 1, 7)
    x1, y1 = poc(1, i * 60 / 360)
    x2, y2 = poc(1, w * 60 / 360)
    line(x + x1 * f, y + y1 * f, x + x2 * f, y + y2 * f, i)
  end
end

function plr_draw()
  spt = spr_tbl[plr_pos]
  local x, y = poc(plr_r, (plr_pos - 1) * d60 + d30)
  print(x .. ", " .. y)
  spr(spt.b, cx + x - 8, cy + y - 8, 2, 2, spt.x, spt.y)
end

function ui_draw()
  draw_ui(0, 104, 16, 3, 12)
  print("draw fancy ui here", 10, 114)
end

function dspr(s, r, a, fx, fy)
  local x, y = poc(r, a)
  print(x .. ", " .. y)
  spr(s, cx + x - 8, cy + y - 8, 2, 2, spt.x, spt.y)
end

-->8
function draw_ui(x, y, w, h, c)
  local wc = w - 1
  local hc = h - 1
  -- draw background
  rectfill(x + 3, y + 3, x + 8 * w - 3, y + 8 * h - 3, c)

  -- draw corners
  spr(33, x, y)
  spr(33, x + 8 * wc, y, 1, 1, true, false)
  spr(33, x, y + 8 * hc, 1, 1, false, true)
  spr(33, x + 8 * wc, y + 8 * hc, 1, 1, true, true)

  -- draw sides
  for i = 1, w - 2, 1 do
    spr(34, x + 8 * i, y)
    spr(34, x + 8 * i, y + 8 * hc, 1, 1, false, true)
  end

  for i = 1, h - 2, 1 do
    spr(49, x, y + 8 * i)
    spr(49, x + 8 * wc, y + 8 * i, 1, 1, true, false)
  end
end

__gfx__
00000000000000000000000000000aaaaaaa00000555555000080000000800000008800000000000000000000000000000000000000000000000000000000000
0000000000000aa00aa00000000aa888aaaaa0005566665000898000088980000889880000000000000000000000000000000000000000000000000000000000
00700700000aaa0000aaa00000aa8aa8aaa000005665665500899800899a9800899a998000000000000000000000000000000000000000000000000000000000
0007700000aaaa0000aaaa000aa8aa8aaa00000056656565089aa98089aaa98089aaa98000000000000000000000000000000000000000000000000000000000
000770000a8aaa0000aaa8a00a8aa8aaa00000a055666655899aa998089aa800089a980000000000000000000000000000000000000000000000000000000000
0070070008a8aa0000aa8a80aa888aaa00000aaa0565655008999998008999800089980000000000000000000000000000000000000000000000000000000000
00000000a8a8aa0000aa8a8aaaeeaaa00000aaaa0556550000888980000888000008800000000000000000000000000000000000000000000000000000000000
00000000a8a8aa0000aa8a8aaeeaaa00000aa88a0055500000000800000000000000000000000000000000000000000000000000000000000000000000000000
00000000a8a8aa0000aa8a8aeeeaa00000aa8a8a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aa8aaa0000aaa8aaeeaaa0000aa8aa8a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaeeaa00aaeeaaaeaccc000aa8aa8aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaeeaaccaaeeaa00accccaaa8aa8aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000aaeeaccccaeeaa00aacccaaaa88aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aeeaccccaeea0000aaccaaaeeeaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000eeaaaaaaee000000aaaaaeeeaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000ee000000ee00000000aaaeea000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000cc111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1ccccccccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
93040801182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220182201d220
911000000e723097230e723097230e723097230e723097230e723007030e723007030e723007030e723007030e703007030e703007030e703007030e703007030070300703007030070300703007030070300703
01020801301512c1512915125151201511a1511615114151161011110110101161011610116101151011510115101141011410113101131011310113101131011210112101121011310113101141011410115101
01040801182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255
01040801182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255182551d255
00100000160502a0502a0502a05029050290502105022050230502505000000290502c0502f0503205034050330502d0502905024050210501c05019050160501505014050130501405015050000000000000000
__music__
00 01054344

